# Auto-Dev V0.2 PRD

## 目标

实现用户修正入口，支持从修正中学习业务规则。

## 依赖

- V0.1 完成

## 范围

- /auto-dev:fix 命令
- learn-from-fix Skill
- .autodev/rules.md 存储

## 新增目录结构

```
auto-dev/
├── commands/
│   └── fix.md              # 新增
└── skills/
    └── learn-from-fix/     # 新增
        └── SKILL.md
```

## 组件定义

### /auto-dev:fix 命令

**文件**: `commands/fix.md`

**用法**: `/auto-dev:fix "问题描述"`

**职责**: 接收用户反馈、执行修正、触发学习、恢复流程

**流程**:
1. 记录问题（关联当前任务）
2. 执行代码修正
3. 调用 learn-from-fix Skill
4. 检查 Ralph Loop 状态，决定是否继续

**测试边界**:
| 测试点 | 验证内容 |
|-------|---------|
| 问题记录 | 正确关联当前任务上下文 |
| 修正执行 | 代码修改后运行验证 |
| 经验提取 | learn-from-fix skill 被正确调用 |
| 循环运行时 | Ralph Loop 运行中自动继续 |
| 循环停止时 | 询问用户是否重新启动 |

### learn-from-fix Skill

**文件**: `skills/learn-from-fix/SKILL.md`

**职责**: 从修正中提取业务规则

**流程**:
1. 分析修正前后代码差异
2. 提取可泛化的规则
3. 询问用户是否记住
4. 若确认 → 写入 .autodev/rules.md

**用户交互示例**:
```
✅ 已修复，登录后现在跳转到首页

💡 要记住这个规则吗？
   "用户登录成功后跳转首页"

[记住] [这次算了]
```

**测试边界**:
| 测试点 | 验证内容 |
|-------|---------|
| 差异分析 | 正确识别修正前后的关键差异 |
| 规则提取 | 生成的规则格式正确且可复用 |
| 用户确认 | 对话框正确显示规则描述 |
| 规则写入 | rules.md 追加格式正确 |
| 用户拒绝 | 选择"这次算了"时不写入 |

### .autodev/rules.md 格式

```markdown
## [日期] 从任务 "XXX" 学到的规则
- 规则: 当遇到 [情况] 时，应该 [做法]
- 原因: [用户反馈]
- 相关文件: [文件路径]
```

## 验收标准

- [ ] /auto-dev:fix 能接收问题描述
- [ ] 能正确修正代码
- [ ] learn-from-fix 能提取规则
- [ ] 用户确认后规则写入 rules.md
- [ ] 修正后能继续 Ralph Loop
