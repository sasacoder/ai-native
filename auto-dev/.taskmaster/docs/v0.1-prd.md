# Auto-Dev V0.1 PRD

## 目标

创建 Plugin 骨架，实现基础执行流程，集成 Ralph Loop。

## 范围

- Plugin 结构
- /auto-dev 主命令
- execute-loop Skill
- 端到端验证

## 目录结构

```
auto-dev/
├── .claude-plugin/
│   └── plugin.json
├── commands/
│   └── auto-dev.md
└── skills/
    └── execute-loop/
        └── SKILL.md
```

## 组件定义

### plugin.json

```json
{
  "name": "auto-dev",
  "version": "0.1.0",
  "description": "自动化开发助手 - 快速迭代，持续学习",
  "commands": ["auto-dev"],
  "skills": ["execute-loop"],
  "mcp_dependencies": ["taskmaster-ai"]
}
```

### /auto-dev 命令

**文件**: `commands/auto-dev.md`

**职责**: 初始化环境、检查/解析任务、启动 Ralph Loop

**流程**:
1. 调用 superpowers:using-git-worktrees 创建隔离环境
2. 调用 TaskMaster get_tasks 检查未完成任务
3. 若无任务 → TaskMaster parse_prd 解析文档
4. 启动 Ralph Loop:
   ```
   /ralph-loop "使用 Skill 工具调用 auto-dev:execute-loop" \
     --completion-promise 'ALL TASKS DONE' \
     --max-iterations 50
   ```

**测试边界**:
| 测试点 | 验证内容 |
|-------|---------|
| 环境准备 | worktree 创建成功 |
| 任务检查 | 有未完成任务时跳过 parse_prd |
| 任务拆解 | parse_prd 参数正确 |
| 循环启动 | Ralph Loop 参数正确 |

### execute-loop Skill

**文件**: `skills/execute-loop/SKILL.md`

**职责**: 获取任务、执行 TDD、处理结果、输出完成信号

**单次迭代流程**:
1. TaskMaster next_task 获取任务
   - 若无任务 → 输出 `<promise>ALL TASKS DONE</promise>`
2. superpowers:test-driven-development 实现
3. superpowers:verification-before-completion 验证
4. 成功 → set_task_status(done)
5. 失败 → superpowers:systematic-debugging → 重试
6. 多次失败 → 暂停提示用户

**测试边界**:
| 测试点 | 验证内容 |
|-------|---------|
| 任务获取 | next_task 返回空时输出 promise |
| TDD 执行 | test-driven-development 流程正确 |
| 验证执行 | verification-before-completion 流程正确 |
| 成功处理 | set_task_status(done) 被调用 |
| 失败处理 | systematic-debugging 被调用 |
| Promise 时机 | 仅在所有任务完成后输出 |

## 验收标准

- [ ] /auto-dev 命令可被识别
- [ ] 能创建 git worktree
- [ ] 能解析 PRD 生成任务
- [ ] Ralph Loop 能正确启动和退出
- [ ] 端到端完成一个简单任务
