---
name: calculate-metrics
description: è®¡ç®—å¹¶æ›´æ–°æ‰§è¡ŒæŒ‡æ ‡åˆ° metrics.json
---

# Calculate Metrics Skill

ä» task-history.json èšåˆæ•°æ®ï¼Œè®¡ç®—æˆåŠŸç‡ã€å¹³å‡è¿­ä»£ç­‰ KPI æŒ‡æ ‡ã€‚

## èŒè´£
- è¯»å– task-history.json
- è®¡ç®—å„é¡¹æŒ‡æ ‡
- æ›´æ–° metrics.json
- åœ¨ä»»åŠ¡å®Œæˆåè‡ªåŠ¨è§¦å‘

## è¾“å…¥/è¾“å‡º
- **è¾“å…¥**: task-history.json æ•°æ®
- **è¾“å‡º**: æ›´æ–°åçš„ `.autodev/metrics.json`

## æ•°æ®ç»“æ„

**metrics.json æ ¼å¼ï¼š**

```json
{
  "totalTasks": 15,
  "completedTasks": 12,
  "successRate": 0.8,
  "avgIterationsPerTask": 2.5,
  "avgTimePerTask": "18m",
  "rulesCount": 8,
  "rulesAppliedCount": 45,
  "fixesCount": 5,
  "lastUpdated": "2024-01-15T15:00:00Z"
}
```

## æŒ‡æ ‡è®¡ç®—

### æˆåŠŸç‡ (successRate)

ä¸€æ¬¡é€šè¿‡çš„ä»»åŠ¡å æ¯”ï¼š

```
successRate = (iterations=1 çš„ä»»åŠ¡æ•°) / totalTasks
```

**ç¤ºä¾‹ï¼š**
- æ€»ä»»åŠ¡: 10
- ä¸€æ¬¡é€šè¿‡: 8
- æˆåŠŸç‡: 0.8 (80%)

### å¹³å‡è¿­ä»£æ•° (avgIterationsPerTask)

å®Œæˆä»»åŠ¡çš„å¹³å‡è¿­ä»£æ¬¡æ•°ï¼š

```
avgIterationsPerTask = sum(iterations) / completedTasks
```

**ç¤ºä¾‹ï¼š**
- è¿­ä»£æ€»è®¡: 25
- å®Œæˆä»»åŠ¡: 10
- å¹³å‡è¿­ä»£: 2.5

### å¹³å‡ç”¨æ—¶ (avgTimePerTask)

å®Œæˆä»»åŠ¡çš„å¹³å‡æ—¶é—´ï¼š

```
avgTime = sum(completedAt - startedAt) / completedTasks
```

**æ ¼å¼åŒ–ï¼š**
- < 60 åˆ†é’Ÿ: "Xm" (å¦‚ "18m")
- >= 60 åˆ†é’Ÿ: "Xh Ym" (å¦‚ "1h 30m")

### è§„åˆ™æœ‰æ•ˆç‡

```
è§„åˆ™æœ‰æ•ˆç‡ = (åº”ç”¨è§„åˆ™åä¸€æ¬¡é€šè¿‡) / (åº”ç”¨è§„åˆ™æ¬¡æ•°)
```

## æµç¨‹

### 1. è¯»å–å†å²æ•°æ®

```
ğŸ“Š è®¡ç®—æŒ‡æ ‡...
- è¯»å–: task-history.json
- æ‰§è¡Œè®°å½•: 15 æ¡
```

### 2. èšåˆè®¡ç®—

```
ğŸ”¢ èšåˆæ•°æ®...
- æ€»ä»»åŠ¡: 15
- å·²å®Œæˆ: 12
- ä¸€æ¬¡é€šè¿‡: 10
- æ€»è¿­ä»£: 30
- æ€»ç”¨æ—¶: 216 åˆ†é’Ÿ
```

### 3. è®¡ç®—æŒ‡æ ‡

```
ğŸ“ˆ è®¡ç®—æŒ‡æ ‡...
- æˆåŠŸç‡: 10/15 = 0.67
- å¹³å‡è¿­ä»£: 30/12 = 2.5
- å¹³å‡ç”¨æ—¶: 216/12 = 18m
- è§„åˆ™åº”ç”¨: 45 æ¬¡
- ä¿®æ­£æ¬¡æ•°: 5 æ¬¡
```

### 4. æ›´æ–°æ–‡ä»¶

```
ğŸ’¾ æ›´æ–° metrics.json...

âœ… æŒ‡æ ‡æ›´æ–°å®Œæˆ
- æ–‡ä»¶: .autodev/metrics.json
- æ›´æ–°æ—¶é—´: 2024-01-15T15:00:00Z
```

## è¾¹ç•Œå¤„ç†

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|-----|---------|
| æ— å†å²è®°å½• | æ‰€æœ‰æŒ‡æ ‡è®¾ä¸º 0 |
| é™¤é›¶é”™è¯¯ | è¿”å› 0 |
| æ— å®Œæˆä»»åŠ¡ | avgIterations å’Œ avgTime è®¾ä¸º 0 |
| æ—¶é—´æ ¼å¼é”™è¯¯ | è·³è¿‡è¯¥è®°å½•çš„æ—¶é—´è®¡ç®— |

## å¢é‡æ›´æ–°

ä¸ºæé«˜æ€§èƒ½ï¼Œæ”¯æŒå¢é‡æ›´æ–°æ¨¡å¼ï¼š

```
ğŸ“Š å¢é‡æ›´æ–°...
- æ–°å®Œæˆä»»åŠ¡: 1
- ä»…æ›´æ–°å—å½±å“æŒ‡æ ‡

å˜æ›´:
- totalTasks: 14 â†’ 15
- completedTasks: 11 â†’ 12
- successRate: é‡æ–°è®¡ç®—
- avgIterationsPerTask: é‡æ–°è®¡ç®—
```

## ä¸ execute-loop çš„é›†æˆ

åœ¨ä»»åŠ¡å®Œæˆåè‡ªåŠ¨è§¦å‘ï¼š

```
æ­¥éª¤5 (ç»“æœå¤„ç† - æˆåŠŸ) â†’ è®°å½•å†å² â†’ è®¡ç®—æŒ‡æ ‡
```
